<div class="container" *ngIf="orderData">
  <!-- ===== ðŸ”· HEADER SECTION ===== -->
  <div class="header">
    <!-- ðŸ”¹ Header Left Side -->
    <div class="header__left">
      <span class="con">
        <!-- ðŸ”¸ Order Title and Status -->
        <h1 class="con__title">Order Id #{{ orderData.order_id }}</h1>
        <span 
          class="status-badge" 
          [ngClass]="'status-badge--' + orderData.status.toLowerCase().replace(' ', '-')">
          {{ orderData.status }}
        </span>

        <!-- ðŸ”¸ Customer Profile -->
        <div class="con__profile">
          <div
            class="con__img__info"
            [ngClass]="!hasProfile() ? 'con__avatar' : 'con__image'"
          >
            <span *ngIf="!hasProfile()">
              {{ orderData.customer.name.charAt(0).toUpperCase() }}{{ orderData.customer.name.split(' ')[1]?.charAt(0).toUpperCase() || '' }}
            </span>
            <div class="img" *ngIf="hasProfile()">
              <img
                [src]="orderData.customer.photo_url"
                [alt]="orderData.customer.name + ' profile image'"
                (error)="hasProfile.set(false)"
              />
            </div>
          </div>
          <span class="con__name">{{ orderData.customer.name }}</span>
        </div>
      </span>

      <!-- ðŸ”¸ Navigation Buttons -->
      <div class="btn__con">
        <button class="btn__1" (click)="onPreviousOrder()">
          <i class="fa fa-arrow-left"></i>
        </button>
        <button class="btn__1" (click)="onNextOrder()">
          <i class="fa fa-arrow-right"></i>
        </button>
      </div>
    </div>

    <!-- ðŸ”¹ Order Date -->
    <div class="header__date m-1">{{ getFormattedDate(orderData.date_ordered) }}</div>

    <!-- ðŸ”¹ Header Actions -->
    <div class="header__actions">
      <button class="btn btn--secondary" (click)="onAssignDeliveryMan()">
        Assign Delivery man
      </button>
      <button class="btn btn--secondary" (click)="onPaymentAction()">
        Payment
      </button>
      <button class="btn btn--primary" (click)="onStatusChange()">
        Status
      </button>
    </div>
  </div>

  <!-- ===== ðŸ”· MAIN CONTENT ===== -->
  <div class="main-content">
    <!-- ===== ðŸ”¹ LEFT PANEL ===== -->
    <div class="left-panel">
      <!-- ðŸ”¸ Order Status Timeline -->
      <div class="order-status">
        <h3 class="order-status__title">Order Status</h3>
        <ul class="order-status__list">
          <li 
            class="order-status__item"
            *ngFor="let status of statusTimeline; let i = index"
            [ngClass]="isStatusActive(i) ? 'active' : 'inactive'"
          >
            <div 
              class="order-status__icon"
              [ngClass]="isStatusActive(i) ? 'order-status__icon--active' : 'order-status__icon--inactive'"
            >
              <span *ngIf="isStatusActive(i)">{{ status.icon }}</span>
              <span *ngIf="!isStatusActive(i)">{{ i + 1 }}</span>
            </div>
            <span>{{ status.label }}</span>
            <span class="order-status__time" *ngIf="isStatusActive(i)">
              <!-- You can add actual timestamps here if available -->
            </span>
          </li>
        </ul>
      </div>

      <!-- ðŸ”¸ Order Tracking Map -->
      <div class="order-tracking">
        <h3 class="order-tracking__title">Order Tracking</h3>
        <div class="order-tracking__map">
          <!-- You can integrate a map component here using the location data -->
          <p>Pickup: {{ orderData.pickup_location.lat }}, {{ orderData.pickup_location.lng }}</p>
          <p>Dropoff: {{ orderData.dropoff_location.lat }}, {{ orderData.dropoff_location.lng }}</p>
          <p>Current: {{ orderData.current_location.lat }}, {{ orderData.current_location.lng }}</p>
        </div>
      </div>

      <!-- ðŸ”¸ Order Summary Section -->
      <div class="order-summary">
        <h3 class="order-summary__title">Summary</h3>
        <div class="order-summary__restaurant">Restaurant ID: {{ orderData.restaurant }}</div>

        <!-- ðŸ§¾ List of Items -->
        <div class="order-summary__items" *ngIf="orderData.items && orderData.items.length > 0">
          <div class="order-summary__item" *ngFor="let item of orderData.items">
            <div class="order-summary__item-image">
              <img 
                *ngIf="item.food_image" 
                [src]="item.food_image" 
                [alt]="item.food_name || 'Food item'"
              >
            </div>
            <div class="order-summary__item-details">
              <div class="order-summary__item-name">
                {{ item.food_name || 'Food Item #' + item.food }}
              </div>
              <div class="order-summary__item-qty">{{ item.quantity }} item{{ item.quantity > 1 ? 's' : '' }}</div>
            </div>
            <div class="order-summary__item-price">
              â‚µ{{ getItemTotal(item).toFixed(2) }}
            </div>
          </div>
        </div>

        <!-- ðŸ”¸ Summary Totals -->
        <div class="order-summary__total-section">
          <div class="order-summary__row">
            <span class="order-summary__row-left">Payment Method</span>
            <span class="order-summary__row-right">{{ orderData.payment_method }}</span>
          </div>
          <div class="order-summary__row">
            <span class="order-summary__row-left">Payment Status</span>
            <span class="order-summary__row-right">{{ orderData.payment_status }}</span>
          </div>
          <div class="order-summary__row" *ngIf="orderData.items">
            <span class="order-summary__row-left">Subtotal</span>
            <span class="order-summary__row-right">â‚µ{{ getSubtotal().toFixed(2) }}</span>
          </div>
          <div class="order-summary__row">
            <span class="order-summary__row-left">Delivery Fee</span>
            <span class="order-summary__row-right">â‚µ{{ parseFloat(orderData.delivery_fee).toFixed(2) }}</span>
          </div>
          <div class="order-summary__row">
            <span class="order-summary__row-left">Platform Fee</span>
            <span class="order-summary__row-right">â‚µ{{ parseFloat(orderData.platform_fee).toFixed(2) }}</span>
          </div>
          <div class="order-summary__row">
            <span class="order-summary__row-left">Tax</span>
            <span class="order-summary__row-right">â‚µ{{ parseFloat(orderData.tax).toFixed(2) }}</span>
          </div>
          <div class="order-summary__row total">
            <span class="order-summary__row-left total">Total</span>
            <span class="order-summary__row-right">â‚µ{{ getGrandTotal().toFixed(2) }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== ðŸ”¹ CUSTOMER INFO PANEL ===== -->
    <div class="customer-info">
      <h3 class="customer-info__title">Customer Info</h3>

      <!-- ðŸ”¸ Customer Profile -->
      <div class="customer-info__profile">
        <div class="customer-info__avatar">
          <img 
            *ngIf="orderData.customer.photo_url; else customerInitials"
            [src]="orderData.customer.photo_url" 
            [alt]="orderData.customer.name + ' profile image'"
            (error)="hasProfile.set(false)"
          />
          <ng-template #customerInitials>
            <span class="avatar-initials">
              {{ orderData.customer.name.charAt(0).toUpperCase() }}{{ orderData.customer.name.split(' ')[1]?.charAt(0).toUpperCase() || '' }}
            </span>
          </ng-template>
        </div>
        <div class="customer-info__details">
          <h3>{{ orderData.customer.name }}</h3>
          <p>{{ orderData.customer.email }}</p>
          <p>Customer ID: {{ orderData.customer.customer_id }}</p>
          <p *ngIf="orderData.customer.is_student" class="student-badge">Student</p>
        </div>
      </div>

      <!-- ðŸ”¸ Phone Number -->
      <div class="customer-info__section">
        <h4>Phone Number</h4>
        <p>
          <a href="tel:{{ orderData.customer.phone }}" class="phone-link">
            {{ orderData.customer.phone }}
          </a>
        </p>
      </div>

      <!-- ðŸ”¸ Location -->
      <div class="customer-info__section">
        <h4>Location</h4>
        <p>{{ orderData.customer.location }}</p>
      </div>

      <!-- ðŸ”¸ Delivery Address -->
      <div class="customer-info__section">
        <h4>Deliver To</h4>
        <p>{{ orderData.customer.location }}</p>
        <p>Coordinates: {{ orderData.dropoff_location.lat }}, {{ orderData.dropoff_location.lng }}</p>
      </div>

      <!-- ðŸ”¸ Delivery Guy Info -->
      <div class="customer-info__delivery-guy" *ngIf="orderData.rider">
        <h4>Delivery Guy</h4>
        <div class="customer-info__delivery-guy-profile">
          <div class="customer-info__delivery-guy-avatar">
            <img 
              *ngIf="orderData.rider.profile_image_url; else riderInitials"
              [src]="orderData.rider.profile_image_url" 
              [alt]="orderData.rider.full_name + ' profile image'"
            />
            <ng-template #riderInitials>
              <span class="avatar-initials">
                {{ orderData.rider.full_name.charAt(0).toUpperCase() }}{{ orderData.rider.full_name.split(' ')[1]?.charAt(0).toUpperCase() || '' }}
              </span>
            </ng-template>
          </div>
          <div class="customer-info__delivery-guy-details">
            <h4>{{ orderData.rider.full_name }}</h4>
            <p>{{ orderData.rider.phone }}</p>
            <p>Code: {{ orderData.rider.rider_code }}</p>
            <p class="rider-status" [ngClass]="orderData.rider.is_active ? 'active' : 'inactive'">
              {{ orderData.rider.is_active ? 'Active' : 'Inactive' }}
            </p>
          </div>
          <div class="customer-info__delivery-guy-actions">
            <button 
              class="customer-info__delivery-guy-btn"
              (click)="onCallRider()"
              title="Call rider"
            >
              ðŸ“ž
            </button>
            <button 
              class="customer-info__delivery-guy-btn"
              (click)="onMessageRider()"
              title="Message rider"
            >
              ðŸ’¬
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading state -->
<div class="loading-container" *ngIf="!orderData">
  <div class="loading-spinner">
    <p>Loading order details...</p>
  </div>
</div>