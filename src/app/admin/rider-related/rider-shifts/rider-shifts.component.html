<div class="main">
  <header>
    <h1>Riders</h1>

    <div class="btn-container">
      <label title="Search By Rider Name">
        <span><i class="fa-solid fa-magnifying-glass"></i></span>
        <input
          type="text"
          name="searchTerm"
          [(ngModel)]="searchTerm"
          (input)="applyFilters()"
          placeholder="Search By Rider Name"
        />
      </label>
      <app-filter-button></app-filter-button>

      <app-button
        buttonText="Add Rider To Shift"
        routerLink="/admin/riders/add-rider"
      ></app-button>

      <select class="btn rounder-2">
        <option value="1" selected disabled>
          <i class="ri-file-download-line"></i> <span>Export</span>
        </option>
      </select>
    </div>
  </header>

  <div
    class="table-parent"
    *ngIf="!isLoading && riders.length > 0; else loading"
  >
    <ng-container *ngIf="filteredriders as filtered">
      <table
        class="table table-hover"
        *ngIf="filtered.length > 0; else noSearchResults"
      >
        <thead class="thead">
          <tr>
            <td style="width: 30px">
              <input
                type="checkbox"
                (change)="toggleSelectAll()"
                [checked]="allSelected()"
              />
            </td>
            <td>
              <strong class="d-flex align-items-center">
                Rider Name <span><svg-icons name="reorder"></svg-icons></span>
              </strong>
            </td>
            <td><strong>Photo</strong></td>
            <td><strong>Phone</strong></td>
            <td><strong>Time</strong></td>
            <td><strong>Area</strong></td>
            <td></td>
            <td><strong>Action</strong></td>
          </tr>
        </thead>
        <tbody class="tbody">
          <tr
            *ngFor="let customer of filtered; index as i"
            [class.checked]="customer.checked"
            [routerLink]="['/admin/riders', customer.rider_code]"
          >
            <td>
              <input
                type="checkbox"
                [checked]="customer.checked"
                (change)="toggleSelection(i)"
                (click)="$event.stopPropagation()"
              />
            </td>
            <td><span>{{ customer.full_name }}</span></td>
            <td>
              <div class="profile">
                <img
                  [src]="customer.profile_image || 'assets/images/profile-img.png'"
                  alt="profile-img"
                  class="img-fluid"
                  style="width: 50px; height: 50px; border-radius: 100%"
                />
              </div>
            </td>
            <td><span>{{ customer.phone }}</span></td>
            <td><span>10:00 AM - 3:00 PM</span></td>
            <td><span>{{ customer.address }}</span></td>
            <td>
              <div class="d-flex align-items-center">
                <span class="me-2">{{ counter }}</span>
                <svg-icons
                  name="play"
                  style="cursor: pointer"
                  (click)="openModal('startModal_' + i)"
                  *ngIf="!shiftStarted"
                ></svg-icons>
                <svg-icons
                  name="pause"
                  style="cursor: pointer"
                  (click)="openModal('pauseModal_' + i)"
                  *ngIf="shiftStarted"
                ></svg-icons>
              </div>
            </td>
            <td>
              <div class="actions" (click)="$event.stopPropagation()">
                <app-dropdown
                  [ellipsis]="true"
                  [options]="[
                    {
                      label: 'View',
                      value: 'view',
                      icon: 'view-eye',
                      iconPosition: 'left'
                    },
                    {
                      label: 'Edit',
                      value: 'edit',
                      icon: 'pencil',
                      iconPosition: 'left'
                    },
                    {
                      label: 'Disable',
                      value: 'disable',
                      icon: 'times',
                      iconPosition: 'left'
                    }
                  ]"
                ></app-dropdown>
              </div>
            </td>

            <!-- Start Modal -->
            <app-modal
              *ngIf="activeModalId === 'startModal_' + i"
              [isVisible]="true"
              (isVisibleChange)="closeModal()"
              size="md"
            >
              <div class="add-product">
                <div class="heading">
                  <h5 class="text-center">Rider Attendance</h5>
                </div>
                <div class="attendance-select">
                  <p class="mt-5">Attendance</p>
                  <select name="attendance" class="form-control">
                    <option value="1" selected>10:00 AM - 3:00 PM</option>
                  </select>
                  <div class="submit w-100">
                    <app-button
                      buttonText="Submit"
                      buttonType="submit"
                      size="md"
                      (click)="closeModal(); shiftStarted = true; startCount();"
                    ></app-button>
                  </div>
                </div>
              </div>
            </app-modal>

            <!-- Pause Modal -->
            <app-modal
              *ngIf="activeModalId === 'pauseModal_' + i"
              [isVisible]="true"
              (isVisibleChange)="closeModal()"
              size="md"
            >
              <div class="add-product">
                <div class="heading">
                  <h5 class="text-center">Rider Check in</h5>
                </div>
                <div class="attendance-select">
                  <p class="mt-5">Attendance</p>
                  <form>
                    <input
                      type="number"
                      placeholder="Enter secret code"
                      class="form-control"
                    />
                    <div class="submit w-100">
                      <app-button
                        buttonText="Submit"
                        buttonType="submit"
                        size="md"
                        (click)="openModal('confirmModal_' + i);"
                      ></app-button>
                    </div>
                  </form>
                </div>
              </div>
            </app-modal>

            <!-- Confirm Modal -->
            <app-modal
              *ngIf="activeModalId === 'confirmModal_' + i"
              [isVisible]="true"
              (isVisibleChange)="closeModal()"
              size="md"
            >
              <div class="add-product">
                <div class="heading">
                  <h5 class="text-center">Confirm</h5>
                </div>
                <div class="attendance-select">
                  <p class="mt-5 text-center">
                    Are you sure that, this rider wants to check out for todayâ€™s shift?
                  </p>
                </div>
                <div
                  class="actions d-flex align-items-center justify-content-center mt-5"
                  style="gap: 10px;"
                >
                  <app-button
                    buttonText="Cancel"
                    buttonType="button"
                    color="secondary"
                    (click)="closeModal()"
                  ></app-button>
                  <app-button
                    buttonText="Submit"
                    buttonType="button"
                    (click)="closeModal(); shiftStarted = false; stopCount(); counter = '00:00:00'"
                  ></app-button>
                </div>
              </div>
            </app-modal>
          </tr>
        </tbody>
      </table>
      <ng-template #noSearchResults>
        <empty-search />
      </ng-template>
    </ng-container>

    <div class="pages" *ngIf="filteredriders.length > 0">
      <div class="count">
        <span>{{ currentPage }} of {{ totalPages }}</span>
      </div>
      <app-pagination
        *ngIf="totalPages >= 1"
        [totalCount]="totalCount"
        [itemsPerPage]="itemsPerPage"
        [currentPage]="currentPage"
        (pageChange)="onPageChange($event)"
      ></app-pagination>
    </div>
  </div>

  <ng-template #emptyList>
    <app-empty-list />
  </ng-template>
  <ng-template #loading>
    <div class="loading-table">
      <app-mini-loader *ngIf="isLoading"></app-mini-loader>
      <app-empty-list *ngIf="!isLoading && riders.length === 0"></app-empty-list>
    </div>
  </ng-template>
</div>
